# 歌词翻译工具

一个功能强大的歌词翻译工具，支持多种歌词格式，借助AI轻松翻译。

## 功能特点

- 支持多种歌词格式：LRC、SRT、ASS、SSA、TXT
- 多种翻译语言支持
- 双语模式（原文+译文）
- 批量翻译功能
- 逐字歌词生成（实验性）
- 实时控制台日志
- 代理服务器状态检测
- 自动代理服务器管理
- 多语言翻译质量优化
- 长文本自动分割处理
- 智能错误处理和重试机制

## 翻译功能

### 支持的语言

- **中文** (zh-CN)
- **英语** (en)
- **日语** (ja)
- **韩语** (ko)
- **法语** (fr)
- **德语** (de)
- **西班牙语** (es)
- **俄语** (ru)
- **葡萄牙语** (pt)
- **意大利语** (it)
- **荷兰语** (nl)
- **瑞典语** (sv)
- **挪威语** (no)
- **丹麦语** (da)
- **芬兰语** (fi)

### 技术实现

1. **百度翻译API**：使用百度翻译API提供翻译服务
2. **代理服务器**：本地Node.js代理服务器解决跨域问题
3. **多通道请求**：根据环境自动选择最优请求通道
4. **错误处理**：智能错误检测和友好的错误提示
5. **性能优化**：长文本自动分割，批量处理

### 性能特性

- **响应时间**：平均响应时间约200ms
- **成功率**：测试成功率100%
- **并发处理**：支持批量翻译多个文件
- **长文本支持**：自动分割处理超过5000字符的长文本
- **多语言性能**：支持8种以上语言的快速翻译
- **稳定性**：在各种网络环境下保持稳定运行

### 质量优化

- **翻译结果后处理**：自动修复常见翻译错误
- **语言特定优化**：针对不同语言的翻译结果进行优化
- **标点符号处理**：智能调整标点符号和格式
- **错误修正**：自动修正常见的翻译错误（如"考试"修正为"测试"）
- **重复标点修复**：自动检测和修复重复的标点符号
- **句子结尾优化**：确保翻译结果以适当的标点符号结尾
- **中文表达优化**：优化中文表达，使翻译结果更自然流畅
- **英文表达优化**：优化英文表达，提高翻译质量

## GitHub Pages部署说明

### 部署限制

由于GitHub Pages的静态站点特性，部署到GitHub Pages后，**翻译功能需要本地代理服务器支持**。这是因为：

1. 百度翻译API有跨域限制，无法直接从浏览器调用
2. GitHub Pages不支持运行Node.js服务器
3. 翻译功能依赖本地代理服务器解决跨域问题

### 本地使用指南

要使用完整的翻译功能，请按照以下步骤操作：

1. **克隆项目到本地**
   ```bash
   git clone https://github.com/your-username/lyrics-translator.git
   cd lyrics-translator
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **启动服务器**
   ```bash
   npm start
   ```
   这将同时启动：
   - HTTP服务器（端口8000）
   - 百度翻译API代理服务器（端口3001）

4. **访问应用**
   打开浏览器访问：
   ```
   http://localhost:8000
   ```

### 直接使用GitHub Pages

如果你直接访问GitHub Pages上的应用（如 `https://your-username.github.io/lyrics-translator`）：

1. 你可以正常上传和查看歌词文件
2. 但翻译功能将不可用，除非你手动启动本地代理服务器
3. 控制台会显示清晰的提示信息，指导你如何启动代理服务器

## 快速开始

### 基本使用

1. 上传歌词文件（支持拖放）
2. 选择源语言和目标语言
3. 点击"开始翻译"按钮
4. 查看翻译结果
5. 下载翻译后的文件

### 批量翻译

1. 上传多个歌词文件
2. 点击"批量翻译"按钮
3. 等待所有文件翻译完成
4. 点击"批量下载"下载所有翻译文件

### 生成逐字歌词

1. 上传歌词文件
2. 上传对应的音频文件
3. 选择源语言
4. 点击"生成逐字歌词"按钮
5. 等待处理完成后查看结果

### 频谱分析功能

频谱分析功能提供实时的音频频谱可视化，帮助用户分析音频特性和歌词同步效果。

#### 功能特点

- **多种可视化模式**：
  - 频谱柱状图 (Bars) - 直观展示频率分布
  - 频谱曲线 (Curve) - 平滑的频谱变化曲线
  - 瀑布图 (Waterfall) - 展示频谱随时间的变化
  - 时域波形图 (Waveform) - 展示音频时域波形

- **可调节参数**：
  - FFT大小 (128, 256, 512, 1024, 2048) - 控制频谱分辨率
  - 平滑系数 (0-1) - 控制频谱变化的平滑程度

- **交互功能**：
  - 频谱快照保存 - 保存当前频谱图像
  - 频率范围选择 - 鼠标拖拽选择频率范围
  - 实时频谱信息显示 - 显示当前峰值频率、峰值能量和平均能量

#### 使用方法

1. **上传音频文件**：在音频上传区域上传您的音频文件
2. **生成逐字歌词**：点击"生成逐字歌词"按钮
3. **切换到逐字歌词面板**：在结果区域切换到"逐字歌词"标签页
4. **开始播放**：点击播放按钮开始播放音频
5. **查看频谱**：在频谱分析区域查看实时频谱显示
6. **调整参数**：使用控制面板调整可视化模式、FFT大小和平滑系数
7. **交互操作**：
   - 拖拽鼠标选择频率范围
   - 点击"保存快照"保存当前频谱图像
   - 点击"切换频谱"隐藏/显示频谱
   - 点击"清空"重置频谱显示

#### 频谱信息说明

- **当前峰值**：显示音频中的主要频率成分
- **峰值能量**：显示当前频谱中的最高能量值
- **平均能量**：显示当前频谱的平均能量值

#### 技术说明

- 使用Web Audio API实现实时频谱分析
- Canvas API进行高性能可视化渲染
- 支持多种音频格式：MP3, WAV, OGG, FLAC, M4A等
- 实时更新频率数据，刷新率可达60fps

#### 注意事项

- 频谱分析功能依赖现代浏览器的Web Audio API支持
- 某些旧浏览器可能不支持频谱分析功能
- 较大的FFT大小会提供更高的频率分辨率，但可能增加CPU占用
- 瀑布图模式会消耗较多内存，建议定期清空数据

### 浏览器兼容性

| 浏览器 | 支持情况 | 备注 |
|--------|----------|------|
| Chrome | ✅ 完全支持 | 推荐使用 |
| Firefox | ✅ 完全支持 | |
| Safari | ✅ 完全支持 | |
| Edge | ✅ 完全支持 | |
| IE11 | ❌ 不支持 | 不支持Web Audio API |

### 音频格式支持

| 格式 | 扩展名 | 支持情况 |
|------|--------|----------|
| MP3 | .mp3 | ✅ 支持 |
| WAV | .wav | ✅ 支持 |
| OGG | .ogg | ✅ 支持 |
| FLAC | .flac | ✅ 支持 |
| M4A | .m4a | ✅ 支持 |
| WMA | .wma | ⚠️ 部分支持 |
| AIFF | .aiff | ✅ 支持 |
| APE | .ape | ⚠️ 部分支持 |

## 代理服务器

### 为什么需要代理服务器？

百度翻译API有严格的跨域限制，浏览器无法直接调用。代理服务器作为中间层，解决了跨域问题，同时提供了更好的错误处理和日志记录。

### 启动代理服务器

```bash
# 方式1：同时启动HTTP服务器和代理服务器
npm start

# 方式2：仅启动代理服务器
npm run start:proxy
```

### 代理服务器配置

- 代理地址：http://localhost:3001/translate
- 支持POST请求
- 自动处理CORS问题
- 支持请求日志记录

## 技术栈

- HTML5 + CSS3 + JavaScript
- Node.js（用于代理服务器）
- 百度翻译API
- 无外部依赖（纯前端实现）

## 项目结构

```
lyrics-translator/
├── css/
│   └── style.css          # 样式文件
├── js/
│   ├── services/
│   │   ├── aiService.js   # AI翻译服务
│   │   └── browserProxy.js # 浏览器内代理
│   ├── utils/
│   │   ├── file.js        # 文件处理工具
│   │   └── env.js         # 环境检测工具
│   ├── parsers/           # 各种格式解析器
│   │   ├── lrcParser.js
│   │   ├── srtParser.js
│   │   ├── assParser.js
│   │   ├── txtParser.js
│   │   └── parserManager.js
│   └── app.js             # 主应用逻辑
├── md5.js                 # MD5加密算法
├── proxy.js               # 代理服务器
├── proxy-manager.js       # 代理服务器管理器
├── start.js               # 启动脚本
├── test-translation.js    # 翻译功能测试脚本
├── test-performance.js    # 性能测试脚本
├── test-multilingual.js   # 多语言测试脚本
├── package.json           # 项目配置
├── README.md              # 项目说明
└── index.html             # 主页面
```

## 常见问题

### 1. 翻译失败，提示"Failed to fetch"？

**解决方案**：
- 确保本地代理服务器已启动
- 检查网络连接
- 查看控制台日志获取详细错误信息
- 尝试重启代理服务器：`npm start`

### 2. 代理服务器无法启动？

**可能原因**：
- 端口3001已被占用
- Node.js未安装
- 权限不足

**解决方案**：
- 关闭占用端口3001的程序
- 安装最新版本的Node.js
- 以管理员权限运行命令提示符
- 尝试使用不同端口：`PROXY_PORT=3005 npm start`

### 3. 翻译结果不准确？

**解决方案**：
- 检查源语言设置是否正确
- 尝试调整目标语言
- 确保歌词文本格式正确
- 对于长文本，系统会自动分割处理，翻译质量可能会有所下降

### 4. 翻译速度慢？

**可能原因**：
- 网络连接不稳定
- 文本长度过长
- 百度翻译API响应延迟

**解决方案**：
- 检查网络连接
- 对于长文本，耐心等待系统处理
- 避免同时提交多个翻译请求

### 5. 多语言翻译支持哪些语言？

**支持的语言**：
- 中文、英语、日语、韩语、法语、德语、西班牙语、俄语
- 葡萄牙语、意大利语、荷兰语、瑞典语、挪威语、丹麦语、芬兰语

### 6. 如何使用批量翻译功能？

**操作步骤**：
1. 上传多个歌词文件
2. 选择源语言和目标语言
3. 点击"批量翻译"按钮
4. 等待所有文件翻译完成
5. 点击"批量下载"获取翻译后的文件

### 7. GitHub Pages上无法使用翻译功能？

**原因**：
- GitHub Pages是静态站点，不支持运行Node.js服务器
- 百度翻译API有跨域限制

**解决方案**：
- 克隆项目到本地运行：`npm start`
- 本地启动代理服务器后再访问GitHub Pages

### 8. 翻译文本过长怎么办？

**解决方案**：
- 系统会自动检测并分割长文本
- 长文本会被分成多个部分进行翻译，然后合并结果
- 对于超长文本，可能会影响翻译质量，建议分段处理

## 开发说明

### 本地开发

```bash
# 启动开发服务器（端口8000）
npm run start:http

# 启动代理服务器（端口3001）
npm run start:proxy
```

### 项目配置

主要配置文件：
- `js/services/aiService.js`：AI服务配置
- `proxy.js`：代理服务器配置

## 许可证

ISC

## 贡献

欢迎提交Issue和Pull Request！

## 注意事项

- 本项目仅用于学习和研究目的
- 请遵守百度翻译API的使用条款
- 翻译结果可能存在偏差，请自行校对

---

**使用本工具即表示您同意上述条款和注意事项。**
