<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歌词翻译工具</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
            display: none;
        }
        .log-container {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-bottom: 1px solid #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>百度翻译API测试</h1>
        
        <div class="test-section">
            <h2>MD5测试</h2>
            <button class="test-button" onclick="testMD5()">测试MD5函数</button>
            <div id="md5-result" class="test-result"></div>
        </div>
        
        <div class="test-section">
            <h2>代理服务器测试</h2>
            <button class="test-button" onclick="testProxy()">测试代理服务器</button>
            <div id="proxy-result" class="test-result"></div>
        </div>
        
        <div class="log-container">
            <h2>测试日志</h2>
            <div id="test-log"></div>
        </div>
    </div>
    
    <!-- JavaScript 文件 -->
    <script src="js/utils/file.js"></script>
    <script src="js/parsers/lrcParser.js"></script>
    <script src="js/parsers/srtParser.js"></script>
    <script src="js/parsers/assParser.js"></script>
    <script src="js/parsers/txtParser.js"></script>
    <script src="js/parsers/parserManager.js"></script>
    <script src="js/services/aiService.js"></script>
    <script src="js/md5.js"></script>
    <script>
        // 测试MD5函数
        function testMD5() {
            const testString = 'test';
            const hash = window.md5(testString);
            document.getElementById('md5-result').textContent = `MD5('${testString}') = ${hash}`;
            log(`MD5测试完成: ${hash}`);
        }
        
        // 测试代理服务器
        async function testProxy() {
            const testText = 'Hello world';
            const appid = '20251221002524051';
            const secretKey = 'tuvZN9D5mU7MtYcCPreF';
            const salt = '123456789';
            const sign = window.md5(`${appid}${testText}${salt}${secretKey}`);
            
            const formData = new FormData();
            formData.append('q', testText);
            formData.append('from', 'en');
            formData.append('to', 'zh');
            formData.append('appid', appid);
            formData.append('salt', salt);
            formData.append('sign', sign);
            
            try {
                log('发送测试请求到代理服务器...');
                const response = await fetch('http://localhost:3001/translate', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                log(`代理服务器响应: ${JSON.stringify(data)}`);
                
                if (data.error) {
                    document.getElementById('proxy-result').textContent = `错误: ${data.error}`;
                    document.getElementById('proxy-result').style.color = 'red';
                } else {
                    document.getElementById('proxy-result').textContent = `成功: ${JSON.stringify(data)}`;
                    document.getElementById('proxy-result').style.color = 'green';
                }
            } catch (error) {
                log(`代理服务器测试失败: ${error.message}`);
                document.getElementById('proxy-result').textContent = `错误: ${error.message}`;
                document.getElementById('proxy-result').style.color = 'red';
            }
        }
        
        // 日志函数
        function log(message) {
            const logContainer = document.getElementById('test-log');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = `[${new Date().toLocaleString()}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
    </script>
</body>
</html>