<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歌词翻译工具</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="title-section">
                    <h1>歌词翻译工具</h1>
                    <p>支持多种歌词格式，借助AI轻松翻译</p>
                </div>
                <div class="version-info">
                    <span>版本: 1.0.0</span>
                </div>
            </div>
        </header>

        <main>
            <!-- 文件上传区域 -->
            <section class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <div class="upload-icon">📁</div>
                        <h3>拖放歌词文件到此处</h3>
                        <p>或</p>
                        <button class="btn" id="browseBtn">浏览文件</button>
                        <input type="file" id="fileInput" accept=".lrc,.srt,.ass,.ssa,.txt" multiple style="display: none;">
                    </div>
                </div>
            </section>
            
            <!-- 音频上传区域 -->
            <section class="audio-upload-section" style="margin-top: 1rem;">
                <div class="audio-upload-content">
                    <h3>上传原歌曲文件（用于生成逐字歌词）</h3>
                    <div class="audio-upload-area" id="audioUploadArea">
                        <div class="audio-upload-icon">🎵</div>
                        <p>拖放音频文件到此处</p>
                        <p>或</p>
                        <button class="btn" id="audioBrowseBtn">浏览音频文件</button>
                        <input type="file" id="audioInput" accept=".mp3,.wav,.ogg,.flac,.ala,.caac,.dd,.aac,.m4a,.wma,.aiff,.ape" style="display: none;">
                    </div>
                    <div class="audio-info" id="audioInfo" style="margin-top: 1rem; display: none;">
                        <span id="audioFileName"></span>
                        <button class="btn btn-small" id="removeAudioBtn">移除</button>
                    </div>
                    <div class="sync-options" style="margin-top: 1rem;">
                        <label for="sourceLang">源语言：</label>
                        <select id="sourceLang">
                            <option value="auto">自动检测</option>
                            <option value="zh-CN">中文</option>
                            <option value="en">英语</option>
                            <option value="ja">日语</option>
                            <option value="ko">韩语</option>
                            <option value="fr">法语</option>
                            <option value="de">德语</option>
                            <option value="es">西班牙语</option>
                        </select>
                        <button class="btn btn-primary" id="generateWordByWordBtn" style="margin-left: 1rem;">生成逐字歌词</button>
                    </div>
                </div>
            </section>

            <!-- 文件列表 -->
            <section class="file-list-section" id="fileListSection" style="display: none;">
                <h2>已上传文件</h2>
                <ul id="fileList"></ul>
            </section>

            <!-- 翻译设置 -->
            <section class="settings-section" id="settingsSection" style="display: none;">
                <h2>翻译设置</h2>
                <!-- API密钥配置面板 -->
                <div class="api-config-panel" style="margin-bottom: 1.5rem; padding: 1rem; background: #f5f5f5; border-radius: 8px;">
                    <h3>API密钥配置</h3>
                    <div class="api-config-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0;">
                        <div class="api-config-item">
                            <label for="appidInput">百度翻译APP ID：</label>
                            <input type="text" id="appidInput" placeholder="请输入百度翻译APP ID" style="width: 100%; padding: 0.5rem; margin-top: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="api-config-item">
                            <label for="secretKeyInput">百度翻译密钥：</label>
                            <input type="password" id="secretKeyInput" placeholder="请输入百度翻译密钥" style="width: 100%; padding: 0.5rem; margin-top: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                    </div>
                    <div class="api-config-actions" style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" id="saveApiConfigBtn">保存配置</button>
                        <button class="btn btn-small" id="resetApiConfigBtn">重置</button>
                        <button class="btn btn-small" id="validateApiConfigBtn">验证配置</button>
                    </div>
                    <div class="api-config-status" id="apiConfigStatus" style="margin-top: 0.5rem; color: #666;"></div>
                </div>
                
                <div class="settings-grid">
                    <div class="setting-item">
                        <label for="translationApi">翻译服务：</label>
                        <select id="translationApi">
                        <option value="baidu">百度翻译API</option>
                    </select>
                    </div>
                    <div class="setting-item">
                        <label for="sourceLang">源语言：</label>
                        <select id="sourceLang">
                            <option value="auto">自动检测</option>
                            <option value="zh-CN">中文</option>
                            <option value="en">英语</option>
                            <option value="ja">日语</option>
                            <option value="ko">韩语</option>
                            <option value="fr">法语</option>
                            <option value="de">德语</option>
                            <option value="es">西班牙语</option>
                            <option value="ru">俄语</option>
                            <option value="pt">葡萄牙语</option>
                            <option value="it">意大利语</option>
                            <option value="nl">荷兰语</option>
                            <option value="sv">瑞典语</option>
                            <option value="no">挪威语</option>
                            <option value="da">丹麦语</option>
                            <option value="fi">芬兰语</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="targetLang">目标语言：</label>
                        <select id="targetLang">
                            <option value="zh-CN">中文</option>
                            <option value="en">英语</option>
                            <option value="ja">日语</option>
                            <option value="ko">韩语</option>
                            <option value="fr">法语</option>
                            <option value="de">德语</option>
                            <option value="es">西班牙语</option>
                            <option value="ru">俄语</option>
                            <option value="pt">葡萄牙语</option>
                            <option value="it">意大利语</option>
                            <option value="nl">荷兰语</option>
                            <option value="sv">瑞典语</option>
                            <option value="no">挪威语</option>
                            <option value="da">丹麦语</option>
                            <option value="fi">芬兰语</option>
                        </select>
                    </div>
                </div>
                <div class="settings-options">
                    <label class="checkbox-option">
                        <input type="checkbox" id="includeOriginal" checked>
                        包含原文（双语模式）
                    </label>
                </div>
                <div class="batch-options" style="margin: 1rem 0;">
                    <button class="btn btn-primary" id="translateBtn">开始翻译</button>
                    <button class="btn btn-primary" id="batchTranslateBtn" style="margin-left: 1rem;">批量翻译</button>
                    <button class="btn btn-primary" id="batchDownloadBtn" style="margin-left: 1rem;">批量下载</button>
                </div>
            </section>

            <!-- 翻译结果 -->
            <section class="result-section" id="resultSection" style="display: none;">
                <h2>翻译结果</h2>
                <div class="result-tabs">
                    <button class="tab-btn active" data-tab="original">原文</button>
                    <button class="tab-btn" data-tab="translated">译文</button>
                    <button class="tab-btn" data-tab="wordByWord">逐字歌词</button>
                </div>
                <div class="result-content">
                    <div class="tab-panel active" id="originalPanel">
                        <pre id="originalLyrics"></pre>
                    </div>
                    <div class="tab-panel" id="translatedPanel">
                        <pre id="translatedLyrics"></pre>
                    </div>
                    <div class="tab-panel" id="wordByWordPanel">
                        <!-- 逐字歌词播放区域 -->
                        <div class="word-by-word-player">
                            <div class="karaoke-display">
                                <div class="karaoke-text" id="karaokeText">
                                    <p class="current-line" id="currentLine">-- 等待播放 --</p>
                                    <p class="next-line" id="nextLine"></p>
                                </div>
                            </div>
                            
                            <!-- 音频控制 -->
                            <div class="audio-controls">
                                <button class="audio-btn" id="playBtn">▶ 播放</button>
                                <button class="audio-btn" id="pauseBtn" style="display: none;">⏸ 暂停</button>
                                <button class="audio-btn" id="stopBtn">⏹ 停止</button>
                                <input type="range" id="progressSlider" class="progress-slider" min="0" max="100" value="0">
                                <span class="time-display" id="timeDisplay">00:00 / 00:00</span>
                                <select id="playbackSpeed" class="speed-select">
                                    <option value="0.5">0.5x</option>
                                    <option value="0.75">0.75x</option>
                                    <option value="1" selected>1.0x</option>
                                    <option value="1.25">1.25x</option>
                                    <option value="1.5">1.5x</option>
                                    <option value="2">2.0x</option>
                                </select>
                            </div>
                            
                            <!-- 频谱分析区域 -->
                            <div class="spectrum-section" style="margin-top: 2rem;">
                                <h3>频谱分析</h3>
                                
                                <!-- 频谱控制区域 -->
                                <div class="spectrum-controls" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; align-items: center; background: #f8f9ff; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);">
                                    <div class="control-group" style="display: flex; flex-direction: column; gap: 0.5rem;">
                                        <label for="visualizationMode" style="font-weight: 600; color: #4a5568; font-size: 0.9rem;">可视化模式:</label>
                                        <select id="visualizationMode" class="control-select" style="padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 4px; background: white; font-size: 0.9rem;">
                                            <option value="bars">频谱柱状图</option>
                                            <option value="curve">频谱曲线</option>
                                            <option value="waterfall">瀑布图</option>
                                            <option value="waveform">时域波形</option>
                                        </select>
                                    </div>
                                    
                                    <div class="control-group" style="display: flex; flex-direction: column; gap: 0.5rem;">
                                        <label for="fftSize" style="font-weight: 600; color: #4a5568; font-size: 0.9rem;">FFT大小:</label>
                                        <select id="fftSize" class="control-select" style="padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 4px; background: white; font-size: 0.9rem;">
                                            <option value="128">128</option>
                                            <option value="256">256</option>
                                            <option value="512" selected>512</option>
                                            <option value="1024">1024</option>
                                            <option value="2048">2048</option>
                                        </select>
                                    </div>
                                    
                                    <div class="control-group" style="display: flex; flex-direction: column; gap: 0.5rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <label for="smoothingTimeConstant" style="font-weight: 600; color: #4a5568; font-size: 0.9rem;">平滑系数:</label>
                                            <span id="smoothingValue" style="font-weight: 600; color: #2b6cb0;">0.8</span>
                                        </div>
                                        <input type="range" id="smoothingTimeConstant" class="control-slider" min="0" max="1" step="0.05" value="0.8" style="width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px; outline: none; -webkit-appearance: none;">
                                    </div>
                                    
                                    <div class="control-group" style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                                        <button class="btn btn-small btn-primary" id="toggleSpectrum" style="padding: 0.5rem 1rem; font-size: 0.9rem;">切换频谱</button>
                                        <button class="btn btn-small btn-secondary" id="saveSpectrum" style="padding: 0.5rem 1rem; font-size: 0.9rem;">保存快照</button>
                                        <button class="btn btn-small btn-danger" id="clearSpectrum" style="padding: 0.5rem 1rem; font-size: 0.9rem;">清空</button>
                                    </div>
                                </div>
                                
                                <!-- 频谱可视化Canvas -->
                                <div class="spectrum-canvas-container" style="background: #000; border-radius: 8px; padding: 1rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
                                    <canvas id="spectrumCanvas" class="spectrum-canvas" width="800" height="400" style="border-radius: 4px; box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5); background: linear-gradient(to bottom, #0a0a0a, #1a1a1a);"></canvas>
                                </div>
                                
                                <!-- 频谱信息显示 -->
                                <div class="spectrum-info" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; background: #f8f9ff; padding: 1rem; border-radius: 8px; margin-top: 1rem; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);">
                                    <div class="info-item" style="display: flex; flex-direction: column; align-items: center; text-align: center; padding: 0.75rem; background: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);">
                                        <span class="info-label" style="font-size: 0.85rem; color: #6b7280; margin-bottom: 0.25rem;">当前峰值频率</span>
                                        <span id="peakFrequency" style="font-size: 1.25rem; font-weight: 700; color: #2b6cb0;">0 Hz</span>
                                    </div>
                                    <div class="info-item" style="display: flex; flex-direction: column; align-items: center; text-align: center; padding: 0.75rem; background: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);">
                                        <span class="info-label" style="font-size: 0.85rem; color: #6b7280; margin-bottom: 0.25rem;">峰值能量</span>
                                        <span id="peakEnergy" style="font-size: 1.25rem; font-weight: 700; color: #48bb78;">0</span>
                                    </div>
                                    <div class="info-item" style="display: flex; flex-direction: column; align-items: center; text-align: center; padding: 0.75rem; background: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);">
                                        <span class="info-label" style="font-size: 0.85rem; color: #6b7280; margin-bottom: 0.25rem;">平均能量</span>
                                        <span id="averageEnergy" style="font-size: 1.25rem; font-weight: 700; color: #ed8936;">0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 逐字编辑区域 -->
                            <div class="word-editor-section" style="margin-top: 2rem;">
                                <h3>歌词编辑</h3>
                                <div class="timeline-editor" id="timelineEditor">
                                    <!-- 时间轴编辑界面将通过JS动态生成 -->
                                </div>
                                <div class="editor-controls">
                                    <button class="btn btn-small" id="saveTimelineBtn">保存时间轴</button>
                                    <button class="btn btn-small" id="resetTimelineBtn">重置时间轴</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="download-options" style="margin: 1rem 0;">
                    <label for="outputFormat">输出格式：</label>
                    <select id="outputFormat">
                        <option value="auto">自动（保持原格式）</option>
                        <option value="lrc">LRC</option>
                        <option value="amll">AMLL</option>
                        <option value="ttml">TTML</option>
                        <option value="db">DB</option>
                        <option value="srt">SRT</option>
                        <option value="txt">TXT</option>
                        <option value="ass">ASS</option>
                        <option value="ssa">SSA</option>
                    </select>
                </div>
                <button class="btn btn-primary" id="downloadBtn">下载翻译文件</button>
            </section>
        </main>

        <!-- 加载状态 -->
        <div class="loading" id="loading" style="display: none;">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>正在翻译，请稍候...</p>
            </div>
        </div>
        
        <!-- 下载进度 -->
        <div class="download-progress" id="downloadProgress" style="display: none;">
            <div class="download-progress-content">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">正在下载...</p>
            </div>
        </div>
        
        <!-- 通知 -->
        <div class="notification" id="notification" style="display: none;">
            <div class="notification-content">
                <span id="notificationText"></span>
                <button class="notification-close" id="notificationClose">×</button>
            </div>
        </div>
        
        <!-- 控制台 -->
        <div class="console-container">
            <div class="console-header">
                <h3>控制台</h3>
                <div class="console-controls">
                    <div class="proxy-status-section">
                        <span class="status-label">代理状态：</span>
                        <span id="proxyStatus" class="status-indicator status-unknown">未检测</span>
                        <span id="proxyInfo" class="proxy-info">-</span>
                    </div>
                    <div class="proxy-controls">
                        <button id="startProxyBtn" class="btn btn-small btn-primary">启动代理</button>
                        <button id="stopProxyBtn" class="btn btn-small btn-danger" disabled>停止代理</button>
                        <button id="restartProxyBtn" class="btn btn-small btn-warning" disabled>重启代理</button>
                        <button id="checkProxyBtn" class="btn btn-small btn-info">检查代理</button>
                    </div>
                    <div class="console-actions">
                        <button id="toggleConsole" class="btn btn-small">收起</button>
                        <button id="clearLog" class="btn btn-small">清空日志</button>
                    </div>
                </div>
            </div>
            <div class="console-body" id="consoleBody">
                <div id="consoleLog" class="console-log"></div>
            </div>
        </div>
    </div>

    <!-- JavaScript 文件 -->
    <script src="md5.js"></script>
    <script src="js/services/aiService.js"></script>
    <script src="js/utils/file.js"></script>
    <script src="js/utils/timelineManager.js"></script>
    <script src="js/generators/AMLLGenerator.js"></script>
    <script src="js/generators/TTMLGenerator.js"></script>
    <script src="js/generators/DBGenerator.js"></script>
    <script src="js/players/WordByWordPlayer.js"></script>
    <script src="js/parsers/lrcParser.js"></script>
    <script src="js/parsers/srtParser.js"></script>
    <script src="js/parsers/assParser.js"></script>
    <script src="js/parsers/txtParser.js"></script>
    <script src="js/parsers/parserManager.js"></script>
    <script src="js/app.js?v=4"></script>
</body>
</html>